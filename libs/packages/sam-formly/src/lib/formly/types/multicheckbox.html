<fieldset class="usa-fieldset">
  <legend class="usa-sr-only">{{ to.label }}</legend>
  <ul class="usa-list--unstyled">
    <li>
      <div class="grid-row" *ngIf="to.selectAllOption">
        <div>
          <input
            class="usa-checkbox__input"
            [id]="id + '_Select'"
            type="checkbox"
            [name]="id + '_name_' + i"
            value="value"
            (change)="onGroupChange($event)"
            [checked]="selectAllChecked"
          />
          <label class="usa-checkbox__label" [for]="id + '_Select'"
            >{{ to.label }}
          </label>
        </div>
        <div>
          <button
            type="button"
            class="sds-button sds-button--circular"
            [attr.aria-expanded]="!isCollapsedContent"
            aria-controls="collapseID"
            (click)="isCollapsedContent = !isCollapsedContent"
          >
            <fa-icon
              [icon]="
                isCollapsedContent ? ['fas', 'angle-down'] : ['fas', 'angle-up']
              "
              size="sm"
            ></fa-icon>
          </button>
        </div>
      </div>
    </li>
    <ul
      id="collapseID"
      [sdsCollapse]="isCollapsedContent"
      class="margin-left-4 usa-list--unstyled"
    >
      <li>
        <div
          *ngFor="
            let option of (to.options | formlySelectOptions: field | async);
            let i = index
          "
        >
          <input
            class="usa-checkbox__input"
            [id]="id + '_' + i"
            type="checkbox"
            [name]="id + '_name_' + i"
            [disabled]="option.disabled"
            [value]="option.value"
            [formlyAttributes]="field"
            (change)="onChange(option.value, $event.target.checked)"
            [checked]="
              formControl.value &&
              (this.to.type === 'array'
                ? formControl.value.includes(option.value)
                : formControl.value[option.value])
            "
          />
          <label class="usa-checkbox__label" [for]="id + '_' + i">{{
            option.label
          }}</label>
        </div>
      </li>
    </ul>
  </ul>
</fieldset>
