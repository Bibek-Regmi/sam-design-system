<div class="sds-table__container" [ngClass]="{'sds-table__container--borderless': borderless}">
  <table cdk-table [dataSource]="dataSource" [multiTemplateDataRows]="detailRow"
    [ngClass]="{'sds-table--expansion': detailRow}" class="sds-table">

    <!-- Columns -->
    <ng-container cdkColumnDef="{{col.primaryKey}}" [sticky]=col.sticky *ngFor="let col of columns">

      <!-- table header cells -->
      <th cdk-header-cell *cdkHeaderCellDef scope="col">

        <!-- sort header button-->
        <button *ngIf="sort" (click)="adjustSort(col.primaryKey)" class="usa-button--unstyled">
          {{ col.header  || (col.primaryKey | titlecase)}}
          <fa-icon *ngIf="sortDirection === 'desc' && sortKey === col.primaryKey"
            [ngClass]="{'active': sortKey === col.primaryKey}" [icon]="['fas', 'caret-down']"></fa-icon>
          <fa-icon *ngIf="sortKey !== col.primaryKey || sortDirection === 'asc' && sortKey === col.primaryKey"
            [ngClass]="{'active': sortKey === col.primaryKey}" [icon]="['fas', 'caret-up']"></fa-icon>
        </button>

        <span *ngIf="!sort">{{ col.header  || (col.primaryKey | titlecase)}}</span>
      </th>

      <td cdk-cell *cdkCellDef="let row">{{row[col.primaryKey] || row[col.alternativeKey]}}</td>
    </ng-container>

    <!-- Expandable detail row -->
    <ng-container cdkColumnDef="expandedDetail">
      <td cdk-cell *cdkCellDef="let row" [attr.colspan]="columnIds.length" class="sds-table__detail">

        <!-- display detailRow templateRef with all row data -->
        <ng-container *ngTemplateOutlet="detailRow; context: row"></ng-container>
      </td>
    </ng-container>

    <!-- column for expandable icon -->
    <ng-container cdkColumnDef=" " *ngIf="detailRow">
      <th cdk-header-cell *cdkHeaderCellDef scope="col"></th>
      <td cdk-cell *cdkCellDef="let row">
        <fa-icon *ngIf="row !== expandedRow" [icon]="['fas', 'chevron-down']"></fa-icon>
        <fa-icon *ngIf="row === expandedRow" [icon]="['fas', 'chevron-up']"></fa-icon>
      </td>
    </ng-container>

    <!-- header  and row declarations -->
    <tr cdk-header-row *cdkHeaderRowDef="columnIds; sticky: stickyHeader" class="sds-table__head"></tr>
    <tr cdk-row *cdkRowDef="let row; columns: columnIds" (click)="toggleRowExpansion(row)" class="sds-table__row"
      [ngClass]="{'sds-table__row--expanded': row === expandedRow}"></tr>
    <ng-container *ngIf="detailRow">
      <tr cdk-row *cdkRowDef="let row; columns: ['expandedDetail']" class="sds-table__row--detail"></tr>
    </ng-container>
  </table>
</div>
